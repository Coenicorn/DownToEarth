(()=>{"use strict";var t={582:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Player=e.Rock=e.GameObject=void 0;const s=i(419),n=i(652),o=i(512);class r{position;dimensions;velocity;acceleration;onground;maxSpeed;id;sprite;constructor(t,e,i,s,n){this.position=t,this.dimensions=e,this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.onground=!1,this.maxSpeed=i,this.id=s,this.sprite=n,this.init()}update(t){this.velocity.x+=this.acceleration.x,this.velocity.y+=this.acceleration.y,this.velocity.x>this.maxSpeed&&(this.velocity.x=this.maxSpeed),this.velocity.x<-this.maxSpeed&&(this.velocity.x=-this.maxSpeed),this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.acceleration={x:0,y:0},this.onground=!1,this.tick()}render(){s.renderer.translateRelative(this.position),s.renderer.color("red"),s.renderer.drawRectangle(0,0,this.dimensions.x,this.dimensions.y),s.renderer.drawSprite(this.sprite,0,0,this.dimensions.x,this.dimensions.y),s.renderer.translateRelative({x:0,y:0})}}e.GameObject=r,e.Rock=class extends r{mass;constructor(t,e,i){super(t,{x:e,y:e},10,"rock",i),this.mass=e}init(){this.velocity={x:Math.round(10*Math.random()-5),y:0}}tick(){this.onground||(this.acceleration.y+=10/this.mass);let t=o.level.getCollidingLines(this);if(t.length){for(;(0,n.intersectsAABBLine)(t[0],this);)this.position.y-=.5;this.onground=!0,console.log(t[0].surfaceNormal.y),this.velocity.y*=-.9}}},e.Player=class extends r{alive;speed;constructor(t,e,i){super(t,e,10,"player",i),this.alive=!0,this.speed=2}init(){}tick(){this.onground||(this.velocity.y+=.7),0==this.acceleration.x&&(this.velocity.x*=.9);let t=o.level.getCollidingLines(this);for(let e=0,i=t.length;e<i;e++){for(;(0,n.intersectsAABBLine)(t[e],this);)this.position.y-=.5;this.onground=!0,this.velocity.y=0}}move(t){switch(t){case 0:this.acceleration.x=-this.speed;break;case 1:this.acceleration.x=this.speed;break;case 2:this.onground&&(this.acceleration.y=-15)}}}},18:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.entityManager=void 0;const i=new class{entities;constructor(){this.entities=[]}getEntity(t){for(let e of this.entities)if(e.id==t)return e;return null}newEntity(t){this.entities.includes(t)||this.entities.push(t)}removeEntity(t){this.entities.includes(t)&&this.entities.splice(this.entities.indexOf(t),1)}update(t){this.entities.forEach((e=>{e.update(t)}))}render(){this.entities.forEach((t=>{t.render()}))}};e.entityManager=i},652:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.lineMeshFromPoints=e.intersectsAABBLine=e.intersectsAABB=e.Line=void 0;class i{a;b;surfaceNormal;constructor(t,e){this.a=t,this.b=e,this.surfaceNormal=this.getSurfaceNormal()}getSurfaceNormal(){let t={x:this.b.x-this.a.x,y:this.b.y-this.a.y},e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));return t.x/=e,t.y/=e,{x:t.y,y:-t.x}}intersects(t){let e,i,s,n,o,r,h,a;e=this.a.x,i=this.a.y,s=this.b.x,n=this.b.y,o=t.a.x,r=t.a.y,h=t.b.x,a=t.b.y;let c=(e-s)*(r-a)-(i-n)*(o-h);if(0==c)return;let l=((e-o)*(r-a)-(i-r)*(o-h))/c,d=((e-o)*(i-n)-(i-r)*(e-s))/c;return l>=0&&l<=1&&d>=0&&d<=1?{x:e+l*(s-e),y:i+l*(n-i)}:void 0}}e.Line=i,e.intersectsAABB=function(t,e){let i,s,n,o;return i=t.position,s={x:t.position.x+t.dimensions.x,y:t.position.y+t.dimensions.y},n=e.position,o={x:e.position.x+e.dimensions.x,y:e.position.y+e.dimensions.y},!(i.x>o.x||s.x<n.x||i.y>o.y||s.y<n.y)},e.intersectsAABBLine=function(t,e){let s,n,o,r,h,a,c,l,d,x,y,f;return s=e.position.x,h=e.position.y,n=e.position.x+e.dimensions.x,a=e.position.y,o=e.position.x+e.dimensions.x,c=e.position.y+e.dimensions.y,r=e.position.x,l=e.position.y+e.dimensions.y,d=new i({x:s,y:h},{x:n,y:a}),x=new i({x:n,y:a},{x:o,y:c}),y=new i({x:o,y:c},{x:r,y:l}),f=new i({x:r,y:l},{x:s,y:h}),null!=t.intersects(d)||null!=t.intersects(x)||null!=t.intersects(y)||null!=t.intersects(f)},e.lineMeshFromPoints=function(t){let e=[];for(let s=1,n=t.length;s<n;s++){let n=t[s],o=t[s-1];e.push(new i({x:o.x,y:o.y},{x:n.x,y:n.y}))}return e}},717:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandler=void 0,e.InputHandler=class{keys;keyBinds;constructor(t){this.keys=[],this.keyBinds=t,addEventListener("keydown",this.keyPressed.bind(this)),addEventListener("keyup",this.keyReleased.bind(this))}keyPressed(t){this.keys.includes(t.key)||this.keys.push(t.key)}keyReleased(t){try{this.keys.splice(this.keys.indexOf(t.key),1)}catch(t){}}releaseAllkeys(){this.keys=[]}handleKeys(){for(let t of this.keys)try{this.keyBinds[t]()}catch(t){}}}},512:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.level=void 0;const s=i(652),n=i(419),o=i(423);class r{mesh;config;xPosition;constructor(t,e,i){this.xPosition=i,this.config=e,this.mesh=[],this.makeLayout(t)}makeLayout(t){let e=[];for(let i=0,s=this.config.maxChunkSegments;i<=s;i++){let s,n,o,r;s=i*this.config.segmentLength+this.xPosition,o=t.noise2D(s/this.config.noiseSampleSize,0),r=0;for(let e=1;e<3;e++)o+=t.noise2D(s/this.config.noiseSampleSize*e,0)/Math.pow(2,e),r+=1/Math.pow(2,e);o/=1+r,o=o*this.config.maxLevelHeight/2,n=o,e.push({x:s,y:n})}e.push({x:this.xPosition+this.config.maxChunkSegments*this.config.segmentLength,y:this.config.levelDownExtension}),e.push({x:this.xPosition,y:this.config.levelDownExtension}),this.mesh=(0,s.lineMeshFromPoints)(e)}}e.level=new class{config;chunks;noiseInstance;constructor(t){this.config=t,this.chunks=[],this.noiseInstance=new o.default,this.generateChunks()}checkPlayerCamera(t){let e,i,s,o;if(o=this.chunks[0].xPosition,e=t.position.x,i=e-n.renderer.center.x-o,s=this.chunks[this.chunks.length-1].xPosition+this.config.maxChunkSegments*this.config.segmentLength-e-n.renderer.center.x,i>0?n.renderer.camera.moveTo(t.position):n.renderer.camera.moveTo({x:o+n.renderer.center.x,y:t.position.y}),t.position.x<=o&&(t.position.x=o),s<0){let t=this.chunks.shift();t.xPosition=this.chunks[this.chunks.length-1].xPosition+this.config.maxChunkSegments*this.config.segmentLength,t.makeLayout(this.noiseInstance),this.chunks.push(t)}}generateChunks(){let t=-this.config.maxChunkSegments*this.config.segmentLength-n.renderer.center.x;for(;!(t>n.renderer.width+this.config.maxChunkSegments*this.config.segmentLength+this.config.renderDistance);)this.chunks.push(new r(this.noiseInstance,this.config,t)),t+=this.config.maxChunkSegments*this.config.segmentLength}renderLevel(){n.renderer.translateRelative({x:0,y:0}),this.chunks.forEach((t=>{n.renderer.color("green"),n.renderer.fillLineMesh(t.mesh)}))}getChunkAt(t){let e=this;return 0==t&&(t+=1),function i(s,n,o){let r=Math.floor((n+o)/2),h=s[r];if(!h)return;let a=h.xPosition,c=h.xPosition+e.config.segmentLength*e.config.maxChunkSegments;return t>=a&&t<=c?h:t>a?i(s,r+1,o):i(s,n,r-1)}(this.chunks,0,this.chunks.length)}getCollidingLines(t){let i=[],n=[];return i.push(e.level.getChunkAt(t.position.x)),i.push(e.level.getChunkAt(t.position.x+t.dimensions.x)),i.forEach((e=>{e?.mesh.forEach((e=>{(0,s.intersectsAABBLine)(e,t)&&n.push(e)}))})),n}}({segmentLength:10,maxLevelHeight:700,noiseSampleSize:2e3,renderDistance:500,maxChunkSegments:50,levelDownExtension:1500})},419:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.renderer=e.loadImages=void 0,e.loadImages=async function(t,e){let i={};for(let s=0,n=t.length;s<n;s++){let n=t[s],o=await new Promise((t=>{let i=new Image;i.src=`${e}/${n}.png`,i.onload=()=>t(i),i.onerror=()=>{throw new Error("Image not found")}}));i[n]=o}return i},e.renderer=new class{canvas;context;width;height;offset;center;camera;constructor(t,e,i,s){this.canvas=s?document.getElementById(s):document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,this.offset={x:0,y:0},this.center={x:this.width/2,y:this.height/2},this.camera=i}clear(){this.context.clearRect(0,0,this.width,this.height)}color(t){this.context.fillStyle=t}drawRectangle(t,e,i,s){t=Math.round(t+this.offset.x),e=Math.round(e+this.offset.y),this.context.fillRect(t,e,i,s)}drawLineMesh(t){this.context.lineWidth=1,this.context.beginPath();let e=t[0];this.context.moveTo(Math.round(e.a.x+this.offset.x),Math.round(e.a.y+this.offset.y)),this.context.lineTo(Math.round(e.b.x+this.offset.x),Math.round(e.b.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.b.x+this.offset.x),Math.round(i.b.y+this.offset.y))}this.context.closePath(),this.context.stroke()}fillLineMesh(t){this.context.beginPath();let e=t[0];this.context.moveTo(Math.round(e.a.x+this.offset.x),Math.round(e.a.y+this.offset.y)),this.context.lineTo(Math.round(e.b.x+this.offset.x),Math.round(e.b.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.b.x+this.offset.x),Math.round(i.b.y+this.offset.y))}this.context.closePath(),this.context.fill()}drawSprite(t,e,i,s=t.width,n=t.height){e=Math.round(e+this.offset.x),i=Math.round(i+this.offset.y),this.context.drawImage(t,e,i,s,n)}drawLine(t,e,i,s,n){t=Math.round(t+this.offset.x),e=Math.round(e+this.offset.y),i=Math.round(i+this.offset.x),s=Math.round(s+this.offset.y),this.context.lineWidth=n,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke(),this.context.closePath()}drawShape(t){let e=t[0];this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(Math.round(e.x+this.offset.x),Math.round(e.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.x+this.offset.x),Math.round(i.y+this.offset.y))}this.context.closePath(),this.context.stroke()}fillShape(t){let e=t[0];this.context.beginPath(),this.context.moveTo(Math.round(e.x+this.offset.x),Math.round(e.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.x+this.offset.x),Math.round(i.y+this.offset.y))}this.context.closePath(),this.context.fill()}translateRelative(t){this.offset.x=t.x+this.camera.position.x+this.center.x,this.offset.y=t.y+this.camera.position.y+this.center.y}translateToScreenCoordinates(t){this.offset.x=t.x,this.offset.y=t.y}getCanvas(){return this.canvas}}(screen.width,screen.height,new class{position;constructor(t){this.position=t}moveTo(t){this.position.x=-t.x,this.position.y=-t.y}}({x:0,y:0}),"gameScreen")},423:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.buildPermutationTable=e.SimplexNoise=void 0;const i=.5*(Math.sqrt(3)-1),s=(3-Math.sqrt(3))/6,n=1/6,o=(Math.sqrt(5)-1)/4,r=(5-Math.sqrt(5))/20,h=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),a=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class c{p;perm;permMod12;constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,i=0,s=0,n=1;const o=function(){let t=4022871197;return function(e){e=e.toString();for(let i=0;i<e.length;i++){t+=e.charCodeAt(i);let s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=4294967296*s}return 2.3283064365386963e-10*(t>>>0)}}();return e=o(" "),i=o(" "),s=o(" "),e-=o(t),e<0&&(e+=1),i-=o(t),i<0&&(i+=1),s-=o(t),s<0&&(s+=1),function(){const t=2091639*e+2.3283064365386963e-10*n;return e=i,i=s,s=t-(n=0|t)}}(t);this.p=l(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,e){const n=this.permMod12,o=this.perm;let r=0,a=0,c=0;const l=(t+e)*i,d=Math.floor(t+l),x=Math.floor(e+l),y=(d+x)*s,f=t-(d-y),u=e-(x-y);let m,g;f>u?(m=1,g=0):(m=0,g=1);const p=f-m+s,v=u-g+s,M=f-1+2*s,k=u-1+2*s,w=255&d,b=255&x;let P=.5-f*f-u*u;if(P>=0){const t=3*n[w+o[b]];P*=P,r=P*P*(h[t]*f+h[t+1]*u)}let S=.5-p*p-v*v;if(S>=0){const t=3*n[w+m+o[b+g]];S*=S,a=S*S*(h[t]*p+h[t+1]*v)}let L=.5-M*M-k*k;if(L>=0){const t=3*n[w+1+o[b+1]];L*=L,c=L*L*(h[t]*M+h[t+1]*k)}return 70*(r+a+c)}noise3D(t,e,i){const s=this.permMod12,o=this.perm;let r,a,c,l;const d=.3333333333333333*(t+e+i),x=Math.floor(t+d),y=Math.floor(e+d),f=Math.floor(i+d),u=(x+y+f)*n,m=t-(x-u),g=e-(y-u),p=i-(f-u);let v,M,k,w,b,P;m>=g?g>=p?(v=1,M=0,k=0,w=1,b=1,P=0):m>=p?(v=1,M=0,k=0,w=1,b=0,P=1):(v=0,M=0,k=1,w=1,b=0,P=1):g<p?(v=0,M=0,k=1,w=0,b=1,P=1):m<p?(v=0,M=1,k=0,w=0,b=1,P=1):(v=0,M=1,k=0,w=1,b=1,P=0);const S=m-v+n,L=g-M+n,A=p-k+n,C=m-w+2*n,B=g-b+2*n,E=p-P+2*n,T=m-1+.5,I=g-1+.5,D=p-1+.5,_=255&x,R=255&y,O=255&f;let j=.6-m*m-g*g-p*p;if(j<0)r=0;else{const t=3*s[_+o[R+o[O]]];j*=j,r=j*j*(h[t]*m+h[t+1]*g+h[t+2]*p)}let N=.6-S*S-L*L-A*A;if(N<0)a=0;else{const t=3*s[_+v+o[R+M+o[O+k]]];N*=N,a=N*N*(h[t]*S+h[t+1]*L+h[t+2]*A)}let q=.6-C*C-B*B-E*E;if(q<0)c=0;else{const t=3*s[_+w+o[R+b+o[O+P]]];q*=q,c=q*q*(h[t]*C+h[t+1]*B+h[t+2]*E)}let F=.6-T*T-I*I-D*D;if(F<0)l=0;else{const t=3*s[_+1+o[R+1+o[O+1]]];F*=F,l=F*F*(h[t]*T+h[t+1]*I+h[t+2]*D)}return 32*(r+a+c+l)}noise4D(t,e,i,s){const n=this.perm;let h,c,l,d,x;const y=(t+e+i+s)*o,f=Math.floor(t+y),u=Math.floor(e+y),m=Math.floor(i+y),g=Math.floor(s+y),p=(f+u+m+g)*r,v=t-(f-p),M=e-(u-p),k=i-(m-p),w=s-(g-p);let b=0,P=0,S=0,L=0;v>M?b++:P++,v>k?b++:S++,v>w?b++:L++,M>k?P++:S++,M>w?P++:L++,k>w?S++:L++;const A=b>=3?1:0,C=P>=3?1:0,B=S>=3?1:0,E=L>=3?1:0,T=b>=2?1:0,I=P>=2?1:0,D=S>=2?1:0,_=L>=2?1:0,R=b>=1?1:0,O=P>=1?1:0,j=S>=1?1:0,N=L>=1?1:0,q=v-A+r,F=M-C+r,H=k-B+r,z=w-E+r,U=v-T+2*r,W=M-I+2*r,G=k-D+2*r,K=w-_+2*r,$=v-R+3*r,J=M-O+3*r,Q=k-j+3*r,V=w-N+3*r,X=v-1+4*r,Y=M-1+4*r,Z=k-1+4*r,tt=w-1+4*r,et=255&f,it=255&u,st=255&m,nt=255&g;let ot=.6-v*v-M*M-k*k-w*w;if(ot<0)h=0;else{const t=n[et+n[it+n[st+n[nt]]]]%32*4;ot*=ot,h=ot*ot*(a[t]*v+a[t+1]*M+a[t+2]*k+a[t+3]*w)}let rt=.6-q*q-F*F-H*H-z*z;if(rt<0)c=0;else{const t=n[et+A+n[it+C+n[st+B+n[nt+E]]]]%32*4;rt*=rt,c=rt*rt*(a[t]*q+a[t+1]*F+a[t+2]*H+a[t+3]*z)}let ht=.6-U*U-W*W-G*G-K*K;if(ht<0)l=0;else{const t=n[et+T+n[it+I+n[st+D+n[nt+_]]]]%32*4;ht*=ht,l=ht*ht*(a[t]*U+a[t+1]*W+a[t+2]*G+a[t+3]*K)}let at=.6-$*$-J*J-Q*Q-V*V;if(at<0)d=0;else{const t=n[et+R+n[it+O+n[st+j+n[nt+N]]]]%32*4;at*=at,d=at*at*(a[t]*$+a[t+1]*J+a[t+2]*Q+a[t+3]*V)}let ct=.6-X*X-Y*Y-Z*Z-tt*tt;if(ct<0)x=0;else{const t=n[et+1+n[it+1+n[st+1+n[nt+1]]]]%32*4;ct*=ct,x=ct*ct*(a[t]*X+a[t+1]*Y+a[t+2]*Z+a[t+3]*tt)}return 27*(h+c+l+d+x)}}function l(t){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let i=0;i<255;i++){const s=i+~~(t()*(256-i)),n=e[i];e[i]=e[s],e[s]=n}return e}e.SimplexNoise=c,e.default=c,e.buildPermutationTable=l}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,i),o.exports}(()=>{const t=i(419),e=i(717),s=i(18),n=i(582),o=i(512);let r,h,a,c,l,d=!0;const x=1e3/60;let y,f,u;function m(){let e=Date.now();f=(e-y)/x,u+=e-y,y=e,r.handleKeys(),s.entityManager.update(f),o.level.checkPlayerCamera(h),u>x&&(t.renderer.clear(),t.renderer.translateToScreenCoordinates({x:0,y:0}),t.renderer.drawSprite(a.Background1,0,0,t.renderer.width,t.renderer.height),o.level.renderLevel(),s.entityManager.render(),u=0),d&&requestAnimationFrame(m)}onload=async function(){a=await(0,t.loadImages)(["Background1","rock1","player"],"./src/assets"),h=new n.Player({x:0,y:-300},{x:50,y:100},a.player),s.entityManager.newEntity(h),s.entityManager.newEntity(new n.Rock({x:0,y:-500},200,a.rock1)),r=new e.InputHandler({a:()=>h.move(0),d:()=>h.move(1)," ":()=>h.move(2),r:()=>{d||(u=0,y=Date.now(),m())}}),l=document.getElementById("button-resume"),c=document.getElementById("menu"),l.onclick=()=>{d||(u=0,y=Date.now(),d=!0,m(),c.style.visibility="hidden")},addEventListener("blur",(()=>{r.releaseAllkeys(),d=!1,c.style.visibility="visible"})),u=0,y=Date.now(),m()}})()})();
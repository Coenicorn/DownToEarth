(()=>{"use strict";var t={582:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Player=e.Rock=e.GameObject=void 0;const s=i(652);class n{position;dimensions;velocity;acceleration;onground;maxSpeed;id;constructor(t,e,i,s){this.position=t,this.dimensions=e,this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.onground=!1,this.maxSpeed=i,this.id=s}update(t){this.tick(),this.velocity.x+=this.acceleration.x,this.velocity.y+=this.acceleration.y,this.velocity.x>this.maxSpeed&&(this.velocity.x=this.maxSpeed),this.velocity.x<-this.maxSpeed&&(this.velocity.x=-this.maxSpeed),this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,0==this.acceleration.x&&(this.velocity.x*=.9),0==this.acceleration.y&&(this.velocity.y*=.9),this.acceleration={x:0,y:0},this.onground=!1}collideLevel(t){let e=[];e.push(t.getChunkAt(this.position.x)),e.push(t.getChunkAt(this.position.x+this.dimensions.x)),e.forEach((t=>{t?.mesh.forEach((t=>{for(;(0,s.intersectsAABBLine)(t,this);)this.velocity.y=0,this.position.x+=.5*t.surfaceNormal.x,this.position.y+=.5*t.surfaceNormal.y,this.velocity.x+=.5*t.surfaceNormal.x,this.onground=!0}))}))}}e.GameObject=n,e.Rock=class extends n{constructor(t,e){super(t,{x:e,y:e},10,"rock")}render(t){t.translateRelative(this.position),t.color("magenta"),t.drawRectangle(0,0,this.dimensions.x,this.dimensions.y),t.translateRelative({x:0,y:0})}tick(){this.onground||(this.acceleration.y=.1)}},e.Player=class extends n{alive;speed;constructor(t,e){super(t,e,10,"player"),this.alive=!0,this.speed=2}tick(){this.onground||(this.acceleration.y=1),this.velocity.x=5}render(t){t.translateRelative(this.position),t.color("red"),t.drawRectangle(0,0,this.dimensions.x,this.dimensions.y),t.translateRelative({x:0,y:0})}move(t){switch(t){case 0:this.acceleration.x=-this.speed;break;case 1:this.acceleration.x=this.speed;break;case 2:this.onground&&(this.acceleration.y=-15)}}}},18:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.entityManager=void 0;const i=new class{entities;constructor(){this.entities=[]}getEntity(t){for(let e of this.entities)if(e.id==t)return e;return null}newEntity(t){this.entities.includes(t)||this.entities.push(t)}removeEntity(t){this.entities.includes(t)&&this.entities.splice(this.entities.indexOf(t),1)}update(t,e){this.entities.forEach((i=>{i.update(e),i.collideLevel(t)}))}render(t){this.entities.forEach((e=>{e.render(t)}))}};e.entityManager=i},652:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.lineMeshFromPoints=e.intersectsAABBLine=e.intersectsAABB=e.Line=void 0;class i{a;b;surfaceNormal;constructor(t,e){this.a=t,this.b=e,this.surfaceNormal=this.getSurfaceNormal()}getSurfaceNormal(){let t={x:this.b.x-this.a.x,y:this.b.y-this.a.y},e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));return t.x/=e,t.y/=e,{x:t.y,y:-t.x}}intersects(t){let e,i,s,n,o,h,r,a;e=this.a.x,i=this.a.y,s=this.b.x,n=this.b.y,o=t.a.x,h=t.a.y,r=t.b.x,a=t.b.y;let c=(e-s)*(h-a)-(i-n)*(o-r);if(0==c)return;let l=((e-o)*(h-a)-(i-h)*(o-r))/c,x=((e-o)*(i-n)-(i-h)*(e-s))/c;return l>=0&&l<=1&&x>=0&&x<=1?{x:e+l*(s-e),y:i+l*(n-i)}:void 0}}e.Line=i,e.intersectsAABB=function(t,e){let i,s,n,o;return i=t.position,s={x:t.position.x+t.dimensions.x,y:t.position.y+t.dimensions.y},n=e.position,o={x:e.position.x+e.dimensions.x,y:e.position.y+e.dimensions.y},!(i.x>o.x||s.x<n.x||i.y>o.y||s.y<n.y)},e.intersectsAABBLine=function(t,e){let s,n,o,h,r,a,c,l,x,d,y,f;return s=e.position.x,r=e.position.y,n=e.position.x+e.dimensions.x,a=e.position.y,o=e.position.x+e.dimensions.x,c=e.position.y+e.dimensions.y,h=e.position.x,l=e.position.y+e.dimensions.y,x=new i({x:s,y:r},{x:n,y:a}),d=new i({x:n,y:a},{x:o,y:c}),y=new i({x:o,y:c},{x:h,y:l}),f=new i({x:h,y:l},{x:s,y:r}),null!=t.intersects(x)||null!=t.intersects(d)||null!=t.intersects(y)||null!=t.intersects(f)},e.lineMeshFromPoints=function(t){let e=[];for(let s=1,n=t.length;s<n;s++){let n=t[s],o=t[s-1];e.push(new i({x:o.x,y:o.y},{x:n.x,y:n.y}))}return e}},717:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandler=void 0,e.InputHandler=class{keys;keyBinds;constructor(t){this.keys=[],this.keyBinds=t,addEventListener("keydown",this.keyPressed.bind(this)),addEventListener("keyup",this.keyReleased.bind(this))}keyPressed(t){this.keys.includes(t.key)||this.keys.push(t.key)}keyReleased(t){try{this.keys.splice(this.keys.indexOf(t.key),1)}catch(t){}}releaseAllkeys(){this.keys=[]}handleKeys(){for(let t of this.keys)try{this.keyBinds[t]()}catch(t){}}}},512:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Level=void 0;const s=i(652),n=i(419),o=i(423);class h{mesh;config;xPosition;renderer;constructor(t,e,i){this.xPosition=i,this.config=e,this.renderer=new n.Renderer(e.maxChunkSegments*e.segmentLength,e.maxLevelHeight+this.config.levelDownExtension,new n.Camera({x:0,y:0})),this.mesh=[],this.makeLayout(t)}makeLayout(t){let e=[];this.renderer.clear();for(let i=0,s=this.config.maxChunkSegments;i<=s;i++){let s,n,o,h;s=i*this.config.segmentLength+this.xPosition,o=t.noise2D(s/this.config.noiseSampleSize,0),h=0;for(let e=1;e<3;e++)o+=t.noise2D(s/this.config.noiseSampleSize*e,0)/Math.pow(2,e),h+=1/Math.pow(2,e);o/=1+h,o=o*this.config.maxLevelHeight/2,n=o,e.push({x:s,y:n})}e.push({x:this.xPosition+this.config.maxChunkSegments*this.config.segmentLength,y:this.config.levelDownExtension}),e.push({x:this.xPosition,y:this.config.levelDownExtension}),this.mesh=(0,s.lineMeshFromPoints)(e)}}e.Level=class{config;chunks;noiseInstance;renderer;constructor(t,e){this.config=t,this.chunks=[],this.noiseInstance=new o.default,this.renderer=e,this.generateChunks()}checkPlayerCamera(t){let e,i,s,n;if(n=this.chunks[0].xPosition,e=t.position.x,i=e-this.renderer.center.x-n,s=this.chunks[this.chunks.length-1].xPosition+this.config.maxChunkSegments*this.config.segmentLength-e-this.renderer.center.x,i>0?this.renderer.camera.moveTo(t.position):this.renderer.camera.moveTo({x:n+this.renderer.center.x,y:t.position.y}),t.position.x<=n&&(t.position.x=n),s<0){let t=this.chunks.shift();t.xPosition=this.chunks[this.chunks.length-1].xPosition+this.config.maxChunkSegments*this.config.segmentLength,t.makeLayout(this.noiseInstance),this.chunks.push(t)}}generateChunks(){let t=-this.config.maxChunkSegments*this.config.segmentLength-this.renderer.center.x;for(;!(t>this.renderer.width+this.config.maxChunkSegments*this.config.segmentLength+this.config.renderDistance);)this.chunks.push(new h(this.noiseInstance,this.config,t)),t+=this.config.maxChunkSegments*this.config.segmentLength}renderLevel(){this.renderer.translateRelative({x:0,y:0}),this.chunks.forEach((t=>{this.renderer.color("green"),this.renderer.fillLineMesh(t.mesh)}))}getChunkAt(t){let e=this;return 0==t&&(t+=1),function i(s,n,o){let h=Math.floor((n+o)/2),r=s[h];if(!r)return;let a=r.xPosition,c=r.xPosition+e.config.segmentLength*e.config.maxChunkSegments;return t>=a&&t<=c?r:t>a?i(s,h+1,o):i(s,n,h-1)}(this.chunks,0,this.chunks.length)}}},419:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=e.Camera=e.loadImages=void 0,e.loadImages=async function(t,e){let i={};for(let s=0,n=t.length;s<n;s++){let n=t[s],o=await new Promise((t=>{let i=new Image;i.src=`${e}/${n}.png`,i.onload=()=>t(i),i.onerror=()=>{throw new Error("Image not found")}}));i[n]=o}return i},e.Camera=class{position;constructor(t){this.position=t}moveTo(t){this.position.x=-t.x,this.position.y=-t.y}},e.Renderer=class{canvas;context;width;height;offset;center;camera;constructor(t,e,i,s){this.canvas=s?document.getElementById(s):document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,this.offset={x:0,y:0},this.center={x:this.width/2,y:this.height/2},this.camera=i}clear(){this.context.clearRect(0,0,this.width,this.height)}color(t){this.context.fillStyle=t}drawRectangle(t,e,i,s){t=Math.round(t+this.offset.x),e=Math.round(e+this.offset.y),this.context.fillRect(t,e,i,s)}drawLineMesh(t){this.context.lineWidth=1,this.context.beginPath();let e=t[0];this.context.moveTo(Math.round(e.a.x+this.offset.x),Math.round(e.a.y+this.offset.y)),this.context.lineTo(Math.round(e.b.x+this.offset.x),Math.round(e.b.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.b.x+this.offset.x),Math.round(i.b.y+this.offset.y))}this.context.closePath(),this.context.stroke()}fillLineMesh(t){this.context.beginPath();let e=t[0];this.context.moveTo(Math.round(e.a.x+this.offset.x),Math.round(e.a.y+this.offset.y)),this.context.lineTo(Math.round(e.b.x+this.offset.x),Math.round(e.b.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.b.x+this.offset.x),Math.round(i.b.y+this.offset.y))}this.context.closePath(),this.context.fill()}drawSprite(t,e,i,s=t.width,n=t.height){e=Math.round(e+this.offset.x),i=Math.round(i+this.offset.y),this.context.drawImage(t,e,i,s,n)}drawLine(t,e,i,s,n){t=Math.round(t+this.offset.x),e=Math.round(e+this.offset.y),i=Math.round(i+this.offset.x),s=Math.round(s+this.offset.y),this.context.lineWidth=n,this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke(),this.context.closePath()}drawShape(t){let e=t[0];this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(Math.round(e.x+this.offset.x),Math.round(e.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.x+this.offset.x),Math.round(i.y+this.offset.y))}this.context.closePath(),this.context.stroke()}fillShape(t){let e=t[0];this.context.beginPath(),this.context.moveTo(Math.round(e.x+this.offset.x),Math.round(e.y+this.offset.y));for(let e=1,i=t.length;e<i;e++){let i=t[e];this.context.lineTo(Math.round(i.x+this.offset.x),Math.round(i.y+this.offset.y))}this.context.closePath(),this.context.fill()}translateRelative(t){this.offset.x=t.x+this.camera.position.x+this.center.x,this.offset.y=t.y+this.camera.position.y+this.center.y}translateToScreenCoordinates(t){this.offset.x=t.x,this.offset.y=t.y}getCanvas(){return this.canvas}}},423:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.buildPermutationTable=e.SimplexNoise=void 0;const i=.5*(Math.sqrt(3)-1),s=(3-Math.sqrt(3))/6,n=1/6,o=(Math.sqrt(5)-1)/4,h=(5-Math.sqrt(5))/20,r=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),a=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class c{p;perm;permMod12;constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,i=0,s=0,n=1;const o=function(){let t=4022871197;return function(e){e=e.toString();for(let i=0;i<e.length;i++){t+=e.charCodeAt(i);let s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=4294967296*s}return 2.3283064365386963e-10*(t>>>0)}}();return e=o(" "),i=o(" "),s=o(" "),e-=o(t),e<0&&(e+=1),i-=o(t),i<0&&(i+=1),s-=o(t),s<0&&(s+=1),function(){const t=2091639*e+2.3283064365386963e-10*n;return e=i,i=s,s=t-(n=0|t)}}(t);this.p=l(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,e){const n=this.permMod12,o=this.perm;let h=0,a=0,c=0;const l=(t+e)*i,x=Math.floor(t+l),d=Math.floor(e+l),y=(x+d)*s,f=t-(x-y),u=e-(d-y);let m,g;f>u?(m=1,g=0):(m=0,g=1);const p=f-m+s,v=u-g+s,M=f-1+2*s,k=u-1+2*s,w=255&x,b=255&d;let P=.5-f*f-u*u;if(P>=0){const t=3*n[w+o[b]];P*=P,h=P*P*(r[t]*f+r[t+1]*u)}let L=.5-p*p-v*v;if(L>=0){const t=3*n[w+m+o[b+g]];L*=L,a=L*L*(r[t]*p+r[t+1]*v)}let S=.5-M*M-k*k;if(S>=0){const t=3*n[w+1+o[b+1]];S*=S,c=S*S*(r[t]*M+r[t+1]*k)}return 70*(h+a+c)}noise3D(t,e,i){const s=this.permMod12,o=this.perm;let h,a,c,l;const x=.3333333333333333*(t+e+i),d=Math.floor(t+x),y=Math.floor(e+x),f=Math.floor(i+x),u=(d+y+f)*n,m=t-(d-u),g=e-(y-u),p=i-(f-u);let v,M,k,w,b,P;m>=g?g>=p?(v=1,M=0,k=0,w=1,b=1,P=0):m>=p?(v=1,M=0,k=0,w=1,b=0,P=1):(v=0,M=0,k=1,w=1,b=0,P=1):g<p?(v=0,M=0,k=1,w=0,b=1,P=1):m<p?(v=0,M=1,k=0,w=0,b=1,P=1):(v=0,M=1,k=0,w=1,b=1,P=0);const L=m-v+n,S=g-M+n,C=p-k+n,A=m-w+2*n,E=g-b+2*n,R=p-P+2*n,T=m-1+.5,B=g-1+.5,I=p-1+.5,D=255&d,_=255&y,O=255&f;let j=.6-m*m-g*g-p*p;if(j<0)h=0;else{const t=3*s[D+o[_+o[O]]];j*=j,h=j*j*(r[t]*m+r[t+1]*g+r[t+2]*p)}let N=.6-L*L-S*S-C*C;if(N<0)a=0;else{const t=3*s[D+v+o[_+M+o[O+k]]];N*=N,a=N*N*(r[t]*L+r[t+1]*S+r[t+2]*C)}let q=.6-A*A-E*E-R*R;if(q<0)c=0;else{const t=3*s[D+w+o[_+b+o[O+P]]];q*=q,c=q*q*(r[t]*A+r[t+1]*E+r[t+2]*R)}let F=.6-T*T-B*B-I*I;if(F<0)l=0;else{const t=3*s[D+1+o[_+1+o[O+1]]];F*=F,l=F*F*(r[t]*T+r[t+1]*B+r[t+2]*I)}return 32*(h+a+c+l)}noise4D(t,e,i,s){const n=this.perm;let r,c,l,x,d;const y=(t+e+i+s)*o,f=Math.floor(t+y),u=Math.floor(e+y),m=Math.floor(i+y),g=Math.floor(s+y),p=(f+u+m+g)*h,v=t-(f-p),M=e-(u-p),k=i-(m-p),w=s-(g-p);let b=0,P=0,L=0,S=0;v>M?b++:P++,v>k?b++:L++,v>w?b++:S++,M>k?P++:L++,M>w?P++:S++,k>w?L++:S++;const C=b>=3?1:0,A=P>=3?1:0,E=L>=3?1:0,R=S>=3?1:0,T=b>=2?1:0,B=P>=2?1:0,I=L>=2?1:0,D=S>=2?1:0,_=b>=1?1:0,O=P>=1?1:0,j=L>=1?1:0,N=S>=1?1:0,q=v-C+h,F=M-A+h,H=k-E+h,z=w-R+h,U=v-T+2*h,W=M-B+2*h,G=k-I+2*h,K=w-D+2*h,$=v-_+3*h,J=M-O+3*h,Q=k-j+3*h,V=w-N+3*h,X=v-1+4*h,Y=M-1+4*h,Z=k-1+4*h,tt=w-1+4*h,et=255&f,it=255&u,st=255&m,nt=255&g;let ot=.6-v*v-M*M-k*k-w*w;if(ot<0)r=0;else{const t=n[et+n[it+n[st+n[nt]]]]%32*4;ot*=ot,r=ot*ot*(a[t]*v+a[t+1]*M+a[t+2]*k+a[t+3]*w)}let ht=.6-q*q-F*F-H*H-z*z;if(ht<0)c=0;else{const t=n[et+C+n[it+A+n[st+E+n[nt+R]]]]%32*4;ht*=ht,c=ht*ht*(a[t]*q+a[t+1]*F+a[t+2]*H+a[t+3]*z)}let rt=.6-U*U-W*W-G*G-K*K;if(rt<0)l=0;else{const t=n[et+T+n[it+B+n[st+I+n[nt+D]]]]%32*4;rt*=rt,l=rt*rt*(a[t]*U+a[t+1]*W+a[t+2]*G+a[t+3]*K)}let at=.6-$*$-J*J-Q*Q-V*V;if(at<0)x=0;else{const t=n[et+_+n[it+O+n[st+j+n[nt+N]]]]%32*4;at*=at,x=at*at*(a[t]*$+a[t+1]*J+a[t+2]*Q+a[t+3]*V)}let ct=.6-X*X-Y*Y-Z*Z-tt*tt;if(ct<0)d=0;else{const t=n[et+1+n[it+1+n[st+1+n[nt+1]]]]%32*4;ct*=ct,d=ct*ct*(a[t]*X+a[t+1]*Y+a[t+2]*Z+a[t+3]*tt)}return 27*(r+c+l+x+d)}}function l(t){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let i=0;i<255;i++){const s=i+~~(t()*(256-i)),n=e[i];e[i]=e[s],e[s]=n}return e}e.SimplexNoise=c,e.default=c,e.buildPermutationTable=l}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,i),o.exports}(()=>{const t=i(419),e=i(717),s=i(18),n=i(582),o=i(512);let h,r,a,c,l,x,d,y,f=!0;const u=1e3/60;let m,g,p;function v(){let t=Date.now();g=(t-m)/u,p+=t-m,m=t,a.handleKeys(),s.entityManager.update(x,g),x.checkPlayerCamera(c),p>u&&(r.clear(),x.renderLevel(),s.entityManager.render(r),p=0),f&&requestAnimationFrame(v)}onload=async function(){l=await(0,t.loadImages)(["Background1"],"./src/assets"),h=new t.Camera({x:0,y:0}),r=new t.Renderer(screen.width,screen.height,h,"gameScreen"),c=new n.Player({x:0,y:-300},{x:50,y:100}),s.entityManager.newEntity(c),s.entityManager.newEntity(new n.Rock({x:0,y:-500},200)),a=new e.InputHandler({a:()=>c.move(0),d:()=>c.move(1)," ":()=>c.move(2),r:()=>{f||(p=0,m=Date.now(),v())}}),x=new o.Level({segmentLength:10,maxLevelHeight:700,noiseSampleSize:2e3,renderDistance:500,maxChunkSegments:50,levelDownExtension:1500},r),y=document.getElementById("button-resume"),d=document.getElementById("menu"),y.onclick=()=>{f||(p=0,m=Date.now(),f=!0,v(),d.style.visibility="hidden")},addEventListener("blur",(()=>{a.releaseAllkeys(),f=!1,d.style.visibility="visible"})),p=0,m=Date.now(),v()}})()})();